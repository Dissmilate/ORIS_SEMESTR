"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5276],{36328:function(e,t,n){let i,o;n.d(t,{Y:function(){return o},c:function(){return i}}),function(e){e.PAYMENT_REQUIRED="PAYMENT_REQUIRED",e.FAILED="FAILED",e.SUCCESS="SUCCESS"}(i||(i={})),function(e){e.PAYMENT_REQUIRED="PAYMENT_REQUIRED",e.FAILED="FAILED",e.UNAVAILABLE="UNAVAILABLE",e.SUCCESS="SUCCESS"}(o||(o={}))},43768:function(e,t,n){n.d(t,{w:function(){return l}});var i=n(17310);var o=n(36328);const r=e=>(0,i.W)(`https://${e}/v15/subscriptions/invoice/sync/status`);let a;!function(e){e.InProgress="SYNCHRONIZATION_IN_PROGRESS",e.Synchronized="SYNCHRONIZED"}(a||(a={}));const c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;return new Promise(((n,i)=>{r(e).then((o=>{let{data:r,error:l}=o;if(l)i();else{const{status:o}=null!==r&&void 0!==r?r:{};if(o!==a.Synchronized){const o=1.1*t;setTimeout((()=>{c(e,o).then(n).catch(i)}),t)}else n()}})).catch((()=>i()))}))},l=e=>{let{hostname:t,promocode:n}=e;return new Promise(((e,r)=>{((e,t)=>(0,i.W)(`https://${e}/v12/subscription-promocodes/activation`,{method:"POST",body:JSON.stringify(t)}))(t,{code:n}).then((n=>{let{data:i}=n;(null===i||void 0===i?void 0:i.status)===o.c.SUCCESS?c(t).then(e).catch(r):r()})).catch(r)}))}},17310:function(e,t,n){n.d(t,{W:function(){return a}});var i=n(4472);function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const a=(e,t)=>new Promise(((n,i)=>{fetch(e,r(r({},t),{},{credentials:"include",headers:{"Content-Type":"application/json"}})).then((e=>{200===e.status?e.json().then((e=>{n({status:200,data:e})})):e.json().then((t=>{n({status:e.status,statusText:e.statusText,error:t})}))})).catch(i)}))},39750:function(e,t,n){function i(e){const{ignoreSelectionsCache:t}=e.query;return Boolean(t&&"false"!==t)}n.d(t,{s:function(){return i}})},3781:function(e,t,n){n.d(t,{H:function(){return o},u:function(){return i}});const i="Source-Id",o=9},28669:function(e,t,n){n.d(t,{K:function(){return i}});const i=6},27305:function(e,t,n){n.d(t,{v:function(){return x}});var i=n(37667),o=n(99013),r=n(34905),a=n(52269),c=n(4033),l=n(4472),s=n(91887);function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const m=e=>{let{cache:t,isPlannedToWatch:n,contentId:i,movieId:o}=e;t.modify({id:(0,s.CV)({contentId:i,movieId:o}),fields:{userData(e,t){let{isReference:i}=t;return i(e)?e:e?d(d({},e),{},{isPlannedToWatch:n}):e}}})};var v=n(97279),f=n(41931),p=n(64888),b=n(40180),y=n(89442),O=n(3781),k=n(57203),h=n(91441),j=n(39750);const S={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"MovieSetPlannedToWatch"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"movieId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Long"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"movie"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"plannedToWatch"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"set"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"movieId"},value:{kind:"Variable",name:{kind:"Name",value:"movieId"}}}]}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"status"}},{kind:"Field",name:{kind:"Name",value:"error"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"message"}},{kind:"Field",name:{kind:"Name",value:"__typename"}}]}},{kind:"Field",name:{kind:"Name",value:"__typename"}}]}},{kind:"Field",name:{kind:"Name",value:"__typename"}}]}},{kind:"Field",name:{kind:"Name",value:"__typename"}}]}}]}}]},g={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"MovieRemovePlannedToWatch"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"movieId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Long"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"movie"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"plannedToWatch"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"remove"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"movieId"},value:{kind:"Variable",name:{kind:"Name",value:"movieId"}}}]}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"status"}},{kind:"Field",name:{kind:"Name",value:"error"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"message"}},{kind:"Field",name:{kind:"Name",value:"__typename"}}]}},{kind:"Field",name:{kind:"Name",value:"__typename"}}]}},{kind:"Field",name:{kind:"Name",value:"__typename"}}]}},{kind:"Field",name:{kind:"Name",value:"__typename"}}]}}]}}]};function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const I=()=>{const e=(()=>{const e=(0,o.x)();return(0,i.useCallback)((t=>{let{selectionId:n,entityId:i}=t;e.cache.modify({id:(0,s.VD)(n),fields:{content(e,t){let{isReference:n}=t;return n(e)?e:null!==e&&void 0!==e&&e.items&&0!==(null===e||void 0===e?void 0:e.items.length)?w(w({},e),{},{items:e.items.filter((e=>!e||!("movie"in e)||!n(e.movie)||e.movie.__ref!==i))}):e}}})}),[e])})(),{selectionKey:t,selectionId:n,selectionPageId:r}=(0,k.H)();return(0,i.useCallback)((i=>{const o=(0,s.wY)(i);e({selectionId:n,entityId:o}),e({selectionId:t,entityId:o}),e({selectionId:r,entityId:o})}),[e,t,n,r])};var N=n(57915);function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const E=()=>{const e=(()=>{const e=(0,o.x)();return(0,i.useCallback)((t=>{let{selectionId:n,entityId:i}=t;e.cache.modify({id:(0,s.VD)(n),fields:{content(e,t){let{toReference:n,isReference:o,readField:r}=t;if(o(e))return e;if(!e)return e;const a=n(i);if(!a)return e;const c=r("viewOption",a),l={__typename:(0,N.i)(c)?"AnnounceSelectionItem":"MovieSelectionItem",movie:a};return null!==e&&void 0!==e&&e.items&&0!==(null===e||void 0===e?void 0:e.items.length)?_(_({},e),{},{items:[l,...e.items]}):_(_({},e),{},{items:[l]})}}})}),[e])})(),{selectionId:t}=(0,k.H)();return(0,i.useCallback)((n=>{const i=(0,s.wY)(n);e({selectionId:t,entityId:i})}),[e,t])};var T=n(57495),F=n(54522),C=n(86185),V=n(2445);function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var W=n(32043),U=n(11699),M=n(28669);const x=()=>{const e=(0,o.x)(),t=(0,W.x)(),n=(0,r.Z)(),{isAuthorized:l}=(0,c.o)(),[u]=(()=>{const{selectionKey:e,selectionHomeId:t,selectionWindowId:n}=(0,k.H)(),i=(0,o.x)(),r=(0,f.useRouter)(),{isAuthorized:a}=(0,c.o)(),l=(0,j.s)(r);return(0,v.D)(S,{onCompleted(e){var t,n,i;const o=null===e||void 0===e||null===(t=e.movie)||void 0===t||null===(n=t.plannedToWatch)||void 0===n||null===(i=n.set)||void 0===i?void 0:i.error;o&&(0,y.H)({message:(0,p.B)((0,b.b)(S),o)})},context:{headers:{[O.u]:O.H}},update:o=>{o.modify({id:(0,s.VD)(e),fields:{content(e,o){let{isReference:r,INVALIDATE:c}=o;return r(e)?e:e?(setTimeout((()=>{i.query({query:h.W,variables:{selectionId:t,showcaseId:n,limit:e.limit,offset:0,ignoreCache:l,withUserData:a,withCatchupSelection:!0},fetchPolicy:"network-only"})}),7e3),c):e}}})},onQueryUpdated:()=>!1})})(),[d]=(0,v.D)(g,{onCompleted(e){var t,n,i;const o=null===e||void 0===e||null===(t=e.movie)||void 0===t||null===(n=t.plannedToWatch)||void 0===n||null===(i=n.remove)||void 0===i?void 0:i.error;o&&(0,y.H)({message:(0,p.B)((0,b.b)(g),o)})},context:{headers:{[O.u]:O.H}}}),P=E(),w=I(),N=(0,i.useCallback)((e=>{let{isFavorite:t,contentId:n}=e;n&&(t?P(n):w(n))}),[P,w]),D=(0,i.useCallback)((e=>{t({type:U.R.Bookmark,message:n.formatMessage({id:"features.movie.4497d8856843dd085397fbc9d07f40b9"}),viewVariant:e,showTime:M.K})}),[t,n]),_=(0,i.useCallback)((e=>{t({type:U.R.Unbookmark,message:n.formatMessage({id:"features.movie.a2450b95d422d4f1d87ddc98458cb032"}),viewVariant:e,showTime:M.K})}),[t,n]);return(0,i.useCallback)((async t=>{let n,{movieId:i,contentId:o,isFavorite:r,onRemoveSuccess:c,onSetSuccess:s,toastViewVariant:v=U.c.Bottom}=t;if(!l&&o){const e=(0,T.Zd)((e=>{const{url:t,query:n}=F.parseUrl((0,C.A)());return F.stringifyUrl({url:t,query:R(R({},n),{},{[V.cG.FAVOURITE_FILM_ID]:e})})})(o));return void document.location.assign(e)}const f=r?c:s,p=r?_:D;if(m({cache:e.cache,contentId:o,movieId:i,isPlannedToWatch:!r}),r){var b,y,O,k;o&&w(o);n=null===(b=(await d({variables:{movieId:i}})).data)||void 0===b||null===(y=b.movie)||void 0===y||null===(O=y.plannedToWatch)||void 0===O||null===(k=O.remove)||void 0===k?void 0:k.status}else{var h,j,S,g;o&&P(o);n=null===(h=(await u({variables:{movieId:i}})).data)||void 0===h||null===(j=h.movie)||void 0===j||null===(S=j.plannedToWatch)||void 0===S||null===(g=S.set)||void 0===g?void 0:g.status}n===a.ne.Success?(null===f||void 0===f||f(),p(v)):(N({contentId:o,isFavorite:r}),m({cache:e.cache,contentId:o,movieId:i,isPlannedToWatch:r}))}),[e,l,P,w,d,N,u,D,_])}},14395:function(e,t,n){let i;n.d(t,{Ui:function(){return a},dC:function(){return i},lK:function(){return o},mm:function(){return r}}),function(e){e.KP_BASIC="kp_basic",e.YA_PREMIUM="ya_premium",e.TVOD_EST="tvod_est",e.HOME="home",e.ONBOARDING="onboarding",e.GAMES="games"}(i||(i={}));const o=10,r=10,a=40},57768:function(e,t,n){n.d(t,{h:function(){return o},u:function(){return i}});const i="watch_later_any",o="watch_later"},57203:function(e,t,n){n.d(t,{H:function(){return d}});var i=n(41931),o=n(37667),r=n(5697),a=n(42923),c=n(55270),l=n(14395),s=n(9170),u=n(57768);const d=()=>{const e=(0,i.useRouter)(),t=(e=>{switch(e){case c.u.BUY:return l.dC.TVOD_EST;case c.u.MAIN:default:return l.dC.HOME}})((0,a.I)()),n=(0,s.W)(e)||t;return(0,o.useMemo)((()=>({selectionId:u.u,selectionHomeId:u.h,selectionWindowId:n,selectionKey:(0,r.B)(u.h,n),selectionPageId:(0,r.B)(u.u,n)})),[n])}},9170:function(e,t,n){function i(e){const{selectionWindowId:t}=e.query;return(Array.isArray(t)?t[0]:t)||null}n.d(t,{W:function(){return i}})},92777:function(e,t,n){n.d(t,{d:function(){return i}});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ToastNotification"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"_local"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"toastNotification"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"message"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"viewVariant"}},{kind:"Field",name:{kind:"Name",value:"__typename"}}]}},{kind:"Field",name:{kind:"Name",value:"__typename"}}]}}]}}]}},62981:function(e,t,n){n.d(t,{P:function(){return o}});var i=n(92777);function o(e,t){e.cache.writeQuery({query:i.d,data:{__typename:"Query",_local:{__typename:"QueryLocal",toastNotification:t}},broadcast:!0})}},32043:function(e,t,n){n.d(t,{x:function(){return u}});var i=n(99013),o=n(37667),r=n(11699),a=n(4472);function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}const l=e=>function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({__typename:"ToastNotification"},e);var s=n(62981);const u=()=>{const e=(0,i.x)(),t=(0,o.useRef)();return(0,o.useCallback)((n=>{let{type:i,message:o,viewVariant:a=r.c.Bottom,showTime:c=12}=n;(0,s.P)(e,l({type:i,message:o,viewVariant:a})),t.current&&clearTimeout(t.current),t.current=window.setTimeout((()=>(0,s.P)(e,null)),1e3*c)}),[e])}},57915:function(e,t,n){n.d(t,{i:function(){return o}});var i=n(52269);const o=e=>{var t;return Boolean(null===e||void 0===e||null===(t=e.availabilityAnnounce)||void 0===t?void 0:t.availabilityDate)&&((null===e||void 0===e?void 0:e.purchasabilityStatus)!==i.gY.Purchased||(null===e||void 0===e?void 0:e.watchabilityStatus)!==i.cV.Watchable)}},64995:function(e,t,n){var i=n(4472),o=(n(37667),n(12199)),r=n(47934);function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.Z=e=>(0,r.jsx)("svg",c(c({},(0,o.x)(3.6,3.6,e)),{},{"data-tid":"Bookmark",children:(0,r.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M28.05 13.5V9.3h4.575V5.7H28.05V1.125h-3.6V5.7h-4.2v3.6h4.2v4.2h3.6ZM11.475 5.625h4.275v3.6h-4.275v16.353l4.868-2.524 1.657-.86 1.657.86 4.868 2.524V18h3.6v13.5l-3.6-1.867L18 26.25l-6.525 3.383-3.6 1.867V5.625h3.6Z"})}))},6482:function(e,t,n){var i=n(4472),o=(n(37667),n(12199)),r=n(47934);function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.Z=e=>(0,r.jsx)("svg",c(c({},(0,o.x)(2.4,2.4,e)),{},{"data-tid":"Unbookmark",children:(0,r.jsx)("path",{d:"M5.5 3.5h13V21L12 17.45 5.5 21V3.5Z"})}))}}]);
//# sourceMappingURL=https://kinopoisk-frontend-internal.s3.mds.yandex.net/hd-www/release/_next/static/chunks/5276-c384814b964a5441.js.map