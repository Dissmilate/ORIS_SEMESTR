"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7756],{67797:function(e,n,t){function r(e){var n=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return n.setUTCFullYear(e.getFullYear()),e.getTime()-n.getTime()}t.d(n,{Z:function(){return r}})},91736:function(e,n,t){function r(e,n){if(n.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+n.length+" present")}t.d(n,{Z:function(){return r}})},13799:function(e,n,t){function r(e){if(null===e||!0===e||!1===e)return NaN;var n=Number(e);return isNaN(n)?n:n<0?Math.ceil(n):Math.floor(n)}t.d(n,{Z:function(){return r}})},8790:function(e,n,t){t.d(n,{Z:function(){return l}});var r=t(38772),o=t(67797),a=t(38973),i=t(91736),s=864e5;function c(e,n){(0,i.Z)(2,arguments);var t=(0,a.Z)(e),r=(0,a.Z)(n),c=t.getTime()-(0,o.Z)(t),u=r.getTime()-(0,o.Z)(r);return Math.round((c-u)/s)}function u(e,n){var t=e.getFullYear()-n.getFullYear()||e.getMonth()-n.getMonth()||e.getDate()-n.getDate()||e.getHours()-n.getHours()||e.getMinutes()-n.getMinutes()||e.getSeconds()-n.getSeconds()||e.getMilliseconds()-n.getMilliseconds();return t<0?-1:t>0?1:t}function l(e,n){(0,i.Z)(2,arguments);var t=(0,r.Z)(e),o=(0,r.Z)(n),a=u(t,o),s=Math.abs(c(t,o));t.setDate(t.getDate()-a*s);var l=Number(u(t,o)===-a),g=a*(s-l);return 0===g?0:g}},49845:function(e,n,t){t.d(n,{Z:function(){return i}});var r=t(38772),o=t(91736);var a=function e(n,t,r){return(r=r||[]).length>=t?n.apply(null,r.slice(0,t).reverse()):function(){var o=Array.prototype.slice.call(arguments);return e(n,t,r.concat(o))}}((function(e,n){return(0,o.Z)(2,arguments),(0,r.Z)(e).getTime()-(0,r.Z)(n).getTime()}),2),i=a},3468:function(e,n,t){t.d(n,{Z:function(){return a}});var r=t(38772),o=t(91736);function a(e){return(0,o.Z)(1,arguments),(0,r.Z)(e).getTime()<Date.now()}},81498:function(e,n,t){t.d(n,{Z:function(){return a}});var r=t(38973),o=t(91736);function a(e,n){(0,o.Z)(2,arguments);var t=(0,r.Z)(e),a=(0,r.Z)(n);return t.getTime()===a.getTime()}},18145:function(e,n,t){t.d(n,{Z:function(){return a}});var r=t(81498),o=t(91736);function a(e){return(0,o.Z)(1,arguments),(0,r.Z)(e,Date.now())}},87105:function(e,n,t){t.d(n,{Z:function(){return c}});var r=t(13799),o=t(38772),a=t(91736);function i(e,n){(0,a.Z)(2,arguments);var t=(0,o.Z)(e),i=(0,r.Z)(n);return isNaN(i)?new Date(NaN):i?(t.setDate(t.getDate()+i),t):t}var s=t(81498);function c(e){return(0,a.Z)(1,arguments),(0,s.Z)(e,i(Date.now(),1))}},38973:function(e,n,t){t.d(n,{Z:function(){return a}});var r=t(38772),o=t(91736);function a(e){(0,o.Z)(1,arguments);var n=(0,r.Z)(e);return n.setHours(0,0,0,0),n}},38772:function(e,n,t){t.d(n,{Z:function(){return o}});var r=t(91736);function o(e){(0,r.Z)(1,arguments);var n=Object.prototype.toString.call(e);return e instanceof Date||"object"===typeof e&&"[object Date]"===n?new Date(e.getTime()):"number"===typeof e||"[object Number]"===n?new Date(e):("string"!==typeof e&&"[object String]"!==n||"undefined"===typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://git.io/fjule"),console.warn((new Error).stack)),new Date(NaN))}},27073:function(e,n,t){t.d(n,{M_:function(){return u},if:function(){return f},ks:function(){return g},lJ:function(){return l},lX:function(){return s},pH:function(){return m},pz:function(){return v},qC:function(){return d},yL:function(){return c}});var r=t(4472),o=t(6288);function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e){const n={page:"GamesScreen",_meta:(0,o.w6)(1)};e.trackEvent("Queez.Showed",n)}function c(e,n){const t=(0,o.w6)(1),r=i(i({},n),{},{page:"GamesScreen",_meta:t});e.trackEvent("Queez.GameCard.Showed",r)}let u,l;function g(e,n){const t=(0,o.w6)(1),r=i(i({},n),{},{actionType:"click",page:"GamesScreen",to:"game",_meta:t});e.trackEvent("Queez.GameCard.Navigated",r)}function d(e,n){const t=(0,o.w6)(1),r=i(i({},n),{},{page:"GamesScreen",_meta:t});e.trackEvent("Queez.GameCard.Selected",r)}function m(e,n){const{players:t=-1}=n,r=(0,o.w6)(1),a=i(i({},n),{},{players:t,_meta:r});e.trackEvent("Queez.MainScreen.Showed",a)}function f(e,n){const{players:t=-1}=n,r=(0,o.w6)(1),a=i(i({},n),{},{players:t,_meta:r});e.trackEvent("Queez.MainScreen.Closed",a)}function v(e,n){const t=(0,o.w6)(1),r=i(i({},n),{},{_meta:t});e.trackEvent("Queez.MainScreen.ErrorRaised",r)}!function(e){e.GamesScreen="games_screen"}(u||(u={})),function(e){e.ScanQr="scan_qr",e.Intro="intro",e.Tour="tour",e.Finish="finish",e.Close="close"}(l||(l={}))},58536:function(e,n,t){t.d(n,{_R:function(){return V},jK:function(){return o},jN:function(){return T}});var r,o,a,i,s,c,u,l=function(){return l=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},l.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError,function(e){e.IFrame="iframe",e.Webview="webview"}(r||(r={})),function(e){e.InvalidChannelState="InvalidChannelState",e.FramePongTimeout="FramePongTimeout",e.FrameNotAccessible="FrameNotAccessible",e.StartSessionCancel="StartSessionCancel",e.StartSessionError="StartSessionError",e.StartSessionTimeout="StartSessionTimeout",e.GameSessionSdkFatalError="GameSessionSdkFatalError",e.GameVideoPlayingError="GameVideoPlayingError",e.FetchTokenError="FetchTokenError"}(o||(o={})),function(e){e.GameSdk="GameSdk"}(a||(a={})),function(e){e.StartGameSession="GameSdkStartGameSession",e.PlayGameSession="GameSdkPlayGameSession",e.StorageSetDate="GameSdkStorageSetDate",e.StorageGetDate="GameSdkStorageGetDate"}(i||(i={})),function(e){e.SessionStart="game_sdk.session_start",e.TokenFetched="game_sdk.token_fetched",e.IFrameLoaded="game_sdk.iframe_loaded",e.SessionsSdkInit="game_sdk.session_sdk_init",e.SessionCreate="game_sdk.session_create",e.SessionCancel="game_sdk.session_cancel"}(s||(s={})),function(e){e.SessionStart="game_sdk.session_start"}(c||(c={})),function(e){e.Info="info",e.Debug="debug",e.Warn="warn",e.Error="error",e.Critical="critical",e.Trace="trace"}(u||(u={}));function g(e){var n=e.namespace,t=e.version;return function(e){return function(e,n){var t=(void 0===n?{}:n).version,r=void 0===t?"1":t;return{is:function(n){var t;return(null==n?void 0:n.type)===e&&(null===(t=null==n?void 0:n.meta)||void 0===t?void 0:t.messageVersion)===r},create:function(n){return{type:e,payload:n,meta:{sdkVersion:"1.11.0",messageVersion:r}}}}}("".concat(n).concat(e),{version:t})}}var d=g({namespace:"@kp-game/",version:"1"}),m=d("game-session-frame-loaded");d("game-session-sdk-init");var f,v=d("create-session-request"),S=d("create-session-success"),p=d("game-qr-code"),h=d("game-start"),w=d("game-level-start"),E=d("game-finish"),k=d("close"),y=d("error"),M=d("ping"),b=d("pong"),T={GameSessionFrameLoadedMessage:m,GameQrCodeMessage:p,GameStartMessage:h,GameLevelStartMessage:w,GameFinishMessage:E,CloseMessage:k,ErrorMessage:y,FatalErrorMessage:y};function P(){var e=[];return{clear:function(){e=[]},emit:function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];e.forEach((function(e){return e.apply(void 0,n)}))},listen:function(n){var t=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.apply(void 0,e)};return e.push(t),function(){e=e.filter((function(e){return e!==t}))}}}}function D(){var e=P(),n={listen:e.listen,cancelled:!1};return{signal:n,cancel:function(t){n.cancelled||(n.cancelled=!0,n.reason=t,e.emit())},clear:function(){e.clear()}}}!function(e){e[e.Idle=0]="Idle",e[e.Active=1]="Active"}(f||(f={}));var C,G=function(e,n){return new Promise((function(t,r){var o=e.listen((function(){o(),r(e.reason)}));n().then(t).catch(r)}))},I=g({namespace:"@kp-session-channel/",version:"1"}),Z=I("sender-ready"),O=I("sender-connect"),F=I("receiver-ready"),_=I("receiver-connect");!function(e){e[e.Idle=0]="Idle",e[e.Connection=1]="Connection",e[e.Open=2]="Open",e[e.Close=3]="Close"}(C||(C={}));var j=function(e){var n=this,t=e.origin,r=e.target;this.status=C.Idle,this.handleMessage=function(e){n.emitter.emit(e)},this.isAllowedOrigin=function(e){return e.origin===n.targetOrigin||"*"===n.targetOrigin},this.listenUnsafeMessage=function(e){return window.addEventListener("message",e),function(){window.removeEventListener("message",e)}},this.sendUnsafeMessage=function(e,t){n.target.postMessage(e,n.targetOrigin,t)},this.connect=function(){if(n.connectPromise)return n.connectPromise;if(n.status!==C.Idle)return Promise.reject(new Error(o.InvalidChannelState));var e=D();return n.connectCancelToken=e,n.status=C.Connection,n.connectPromise=new Promise((function(t,r){var o=new MessageChannel,a=o.port1,i=o.port2,s=n.listenUnsafeMessage((function(e){n.isAllowedOrigin(e)&&F.is(e.data)&&(s(),a.onmessage=function(e){if(_.is(e.data))return n.activePort=a,n.status=C.Open,void t();n.handleMessage(e.data)},n.sendUnsafeMessage(O.create(),[i]))})),c=e.signal.listen((function(){c(),s(),a.close(),a.onmessage=null,r(e.signal.reason)}));n.sendUnsafeMessage(Z.create())})),n.connectPromise},this.ready=function(e,t){if(n.status===C.Idle){var r=D();n.connectCancelToken=r,n.status=C.Connection;var a=n.listenUnsafeMessage((function(t){if(n.isAllowedOrigin(t))if(Z.is(t.data))n.sendUnsafeMessage(F.create());else if(O.is(t.data)&&t.ports[0]){a();var o=t.ports[0];n.activePort=o,n.activePort.onmessage=function(e){n.handleMessage(e.data)},n.status=C.Open;var i=r.signal.listen((function(){i(),o.close(),o.onmessage=null}));o.postMessage(_.create()),e()}})),i=r.signal.listen((function(){i(),a()}));n.sendUnsafeMessage(F.create())}else null==t||t(new Error(o.InvalidChannelState))},this.listen=function(e){return n.emitter.listen(e)},this.sendMessage=function(e){n.activePort&&n.activePort.postMessage(e)},this.close=function(){var e,t;null===(e=n.connectCancelToken)||void 0===e||e.cancel(),null===(t=n.activePort)||void 0===t||t.close(),n.activePort=void 0,n.connectPromise=void 0,n.emitter.clear(),n.status=C.Close},this.targetOrigin="file://"===t?"*":t,this.target=r,this.emitter=P()},N=function(e,n){var t=function(e){return l({contentId:n.contentId,sdkVersion:"1.11.0"},e)};return{getTime:e.getTime,time:e.time,timeEnd:e.timeEnd,sendDelta:e.sendDelta,logError:function(n,r){var o=n;return o.additional=t(o.additional),e.logError(o,r)},logEventString:function(n,r,o){var a=null!=o?o:{};return a.additional=t(a.additional),e.logEventString(n,r,a)}}};Object.keys(r).map((function(e){return r[e]}));var U;!function(e){e.DisableAnimation="lite",e.RequiresUserGesture="onweb"}(U||(U={}));var A=function(e){var n,t,r,l,g,d,p=this,h=e.params,w=e.config;this.handleMessage=function(e){var n;if(y.is(e))return null===(n=p.params.logger)||void 0===n||n.logError({level:u.Critical,block:a.GameSdk,sourceMethod:i.PlayGameSession,message:e.payload.cause||e.payload.message,additional:{sdkErrorMessage:e.payload.message,sdkErrorCause:e.payload.cause,sessionSdkVersion:e.meta.sdkVersion,sessionSdkMessageVersion:e.meta.messageVersion}}),void p.params.onError(e);b.is(e)||p.params.onEvent(e)},this.startHealthCheck=function(e){var n,t=function(e,n,t){var r,o,a,i=Math.max(2e3,t.pingInterval),s=Math.max(100,t.pongTimeout),c=f.Idle,u=function(){window.clearTimeout(o),window.clearTimeout(r),a=void 0},l=function(){c=f.Idle,u()},g=function(){l(),n()},d=function(){u();var n=String(Math.random()).slice(2);o=window.setTimeout((function(){a=n,r=window.setTimeout(g,s),e(a)}),i)};return{pong:function(e){e===a&&c===f.Active&&d()},start:function(){c=f.Active,d()},stop:l}}((function(e){var n;return null===(n=p.channel)||void 0===n?void 0:n.sendMessage(M.create({requestId:e}))}),(function(){return p.handleMessage(y.create({message:o.FramePongTimeout}))}),{pingInterval:p.pingInterval,pongTimeout:p.pongTimeout}),r=null===(n=p.channel)||void 0===n?void 0:n.listen((function(e){b.is(e)&&t.pong(e.payload.requestId)})),a=e.listen((function(){a(),t.stop(),null==r||r()}));t.start()},this.buildIFrameUrl=function(e){var n=[p.requiresUserGesture&&U.RequiresUserGesture,p.disableAnimation&&U.DisableAnimation].filter(Boolean).join(",");if(!n.length)return e;var t=e.indexOf("?")<0?"?":"&";return[e,t,"query=".concat(n)].join("")},this.startSession=function(e){return G(e,p.params.getSessionParams).then((function(n){var t=n.baseUrl,r=n.sessionParams,a=function(e){var n=e.frameId,t=e.src,r=document.createElement("iframe");return r.id=n,r.src=t,r.allow="autoplay",r.style.cssText="\n          border: 0;\n          outline: 0;\n          width: 100%;\n          height: 100%;\n          background-color: #000;\n      ",r}({frameId:p.iframeId,src:p.buildIFrameUrl(t)});return new Promise((function(n,i){var c,u=function(e){var n,t,r;window.clearTimeout(l),a.onload=null,null===(n=a.parentNode)||void 0===n||n.removeChild(a),null===(r=null===(t=p.channel)||void 0===t?void 0:t.close)||void 0===r||r.call(t),p.channel=void 0,i(e)},l=setTimeout((function(){return u(new Error(o.StartSessionTimeout))}),p.startTimeout),g=e.listen((function(){g(),u(e.reason)}));null===(c=p.params.logger)||void 0===c||c.time(s.IFrameLoaded),p.containerElement.appendChild(a),a.onload=function(){var i,c,g;null===(i=p.params.logger)||void 0===i||i.timeEnd(s.IFrameLoaded),a.onload=null,a.contentWindow?(p.params.onEvent(m.create()),function(e){var n=e.sessionParams,t=e.cancelSignal,r=e.logger,a=new j({target:e.target,origin:e.origin});return null==r||r.time(s.SessionsSdkInit),G(t,a.connect).then((function(){return null==r||r.timeEnd(s.SessionsSdkInit),new Promise((function(e,i){var c=function(e){u(),a.close(),i(e)},u=a.listen((function(n){if(S.is(n))return null==r||r.timeEnd(s.SessionCreate),u(),void e({channel:a,partnerSessionData:n.payload});if(y.is(n)){var t="".concat(o.StartSessionError,": ").concat(n.payload.cause||n.payload.message);c(new Error(t))}})),l=t.listen((function(){l(),c(t.reason)}));null==r||r.time(s.SessionCreate),a.sendMessage(v.create(n))}))}))}({target:a.contentWindow,origin:(c=t,g=document.createElement("a"),g.href=c,g.origin),sessionParams:r,cancelSignal:e,logger:p.params.logger}).then((function(e){var t=e.channel,r=e.partnerSessionData;window.clearTimeout(l),p.channel=t,p.channel.listen(p.handleMessage),n(r)})).catch(u)):u(new Error(o.FrameNotAccessible))}}))}))},this.start=function(){var e,n,t,r;if(p.sessionStartPromise)return p.sessionStartPromise;var l=null!==(n=null===(e=p.params.logger)||void 0===e?void 0:e.getTime())&&void 0!==n?n:0;null===(t=p.params.logger)||void 0===t||t.logEventString(c.SessionStart,""),null===(r=p.params.logger)||void 0===r||r.time(s.SessionStart);var g=D();return p.sessionCancelToken=g,p.sessionStartPromise=new Promise((function(e,n){var t=g.signal.listen((function(){p.sessionStartPromise=void 0,t(),n(g.signal.reason)}));p.startSession(g.signal).then(e).catch(g.cancel)})).then((function(e){var n;return null===(n=p.params.logger)||void 0===n||n.timeEnd(s.SessionStart),p.startHealthCheck(g.signal),p.params.onStart(e),e})).catch((function(e){if(p.destroy(),p.params.logger){var n=null==e?void 0:e.message;p.params.logger.logError({level:u.Critical,block:a.GameSdk,sourceMethod:i.StartGameSession,message:n,ignoreErrorMessage:!0},e),n===o.StartSessionCancel&&p.params.logger.sendDelta(s.SessionCancel,p.params.logger.getTime()-l)}throw e})),p.sessionStartPromise},this.destroy=function(){var e,n,t;null===(e=p.sessionCancelToken)||void 0===e||e.cancel(new Error(o.StartSessionCancel)),p.sessionCancelToken=void 0,p.sessionStartPromise=void 0,null===(t=null===(n=p.channel)||void 0===n?void 0:n.close)||void 0===t||t.call(n),p.channel=void 0},this.params=h,this.containerElement=w.containerElement,this.iframeId=null!==(n=w.iframeId)&&void 0!==n?n:"kp-game-session",this.startTimeout=Math.min(null!==(t=w.startTimeout)&&void 0!==t?t:3e4,6e4),this.pingInterval=null!==(r=w.pingInterval)&&void 0!==r?r:1e4,this.pongTimeout=null!==(l=w.pongTimeout)&&void 0!==l?l:5e3,this.disableAnimation=null!==(g=w.disableAnimation)&&void 0!==g&&g,this.requiresUserGesture=null!==(d=w.requiresUserGesture)&&void 0!==d&&d},q=function(e){var n=this;this.getSessionParams=function(e){var t;return null===(t=n.logger)||void 0===t||t.time(s.TokenFetched),n.gameDataProvider.fetchGameToken(e).then((function(e){var t,r,o,a=e.baseUrl,i=e.token,c=e.partnerGameId;return null===(t=n.logger)||void 0===t||t.timeEnd(s.TokenFetched),{baseUrl:a,sessionParams:{token:i,partnerGameId:c,partnerSessionData:null===(o=null===(r=n.storage)||void 0===r?void 0:r.getData())||void 0===o?void 0:o.partnerSessionData}}})).catch((function(e){throw new Error("".concat(o.FetchTokenError,": ").concat((null==e?void 0:e.message)||"unknown"))}))},this.createGameSession=function(e){var t=e.sessionParams,r=e.config,o=e.onError,a=e.onEvent;return n.currentSession&&n.currentSession.destroy(),n.currentSession=n.gameSessionFactory({logger:n.logger&&N(n.logger,t),getSessionParams:function(){return n.getSessionParams(t)},onStart:function(e){var t;return null===(t=n.storage)||void 0===t?void 0:t.setData({partnerSessionData:e})},onError:o,onEvent:a},r),n.currentSession},this.destroy=function(){var e;null===(e=n.currentSession)||void 0===e||e.destroy(),n.currentSession=void 0},this.storage=e.storage?function(e){return{setData:function(n){var t;try{var r=JSON.stringify(n);e.storage.setData(r)}catch(n){var o=n instanceof Error?n:void 0;null===(t=e.logger)||void 0===t||t.logError({level:u.Error,block:a.GameSdk,sourceMethod:i.StorageSetDate,message:null==o?void 0:o.message,ignoreErrorMessage:!0},o)}},getData:function(){var n;try{var t=e.storage.getData();return t?JSON.parse(t):void 0}catch(t){var r=t instanceof Error?t:void 0;return void(null===(n=e.logger)||void 0===n||n.logError({level:u.Error,block:a.GameSdk,sourceMethod:i.StorageGetDate,message:null==r?void 0:r.message,ignoreErrorMessage:!0},r))}}}}({storage:e.storage,logger:e.logger}):void 0,this.gameDataProvider=e.gameDataProvider,this.logger=e.logger,this.gameSessionFactory=e.gameSessionFactory},V=function(e){return new q(l(l({},e),{gameSessionFactory:function(e,n){return new A({params:e,config:n})}}))}}}]);
//# sourceMappingURL=https://kinopoisk-frontend-internal.s3.mds.yandex.net/hd-www/release/_next/static/chunks/7756-e7465ff4c4fa4844.js.map